<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Week 4: Data Wrangling</title>
    <meta charset="utf-8" />
    <meta name="author" content="Joe Nese University of Oregon Fall 2022" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <script src="libs/freezeframe/freezeframe.min.js"></script>
    <script src="libs/xaringanExtra-freezeframe/freezeframe-init.js"></script>
    <script id="xaringanExtra-freezeframe-options" type="application/json">{"selector":"img[src$=\"gif\"]","trigger":"click","overlay":false,"responsive":true,"warnings":true}</script>
    <link href="libs/countdown/countdown.css" rel="stylesheet" />
    <script src="libs/countdown/countdown.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Week 4: Data Wrangling
]
.subtitle[
## <code>{dplyr}</code>
]
.author[
### Joe Nese<br><span style="font-size: 50%;">University of Oregon<br>Fall 2022</span>
]

---








# Housekeeping

- Assignment completion
- Midway Student Experience Survey
  + now open
  + Canvas: UO Course Surveys (left sidebar)
- .red[ Final Project Outline]
  + Due 10/26
  
&gt; The outline should include a description of the data to be used, a discussion of what preparatory work will need to be done, and how the requirements of the final project will be met. The outline is intended to be low-stakes and is primarily designed to be a means for you to obtain feedback on the feasibility of the project and areas to consider.

---
class: inverse, left, middle

# Data Wrangling with {dplyr}
## Week 4

---

# Agenda

* Introduce common `{dplyr}` functions
  + piping `{dplyr}` functions
  + helper functions
* Introduce complimentary functions
  + `ifelse()`
  + `case_when()`
  
**Learning Objectives**

* Understand basic data wrangling and transformations
  - `select()`
  - `filter()`
  - `arrange()`
  - `group_by()`
  - `summarize()`
  - `recode()` &amp; `rename()`
* Be able to pipe these functions to efficiently wrangle data

---

background-size: contain

background-image: url("https://www.tidyverse.org/images/tidyverse-default.png")

---

# Providing grammar for:

* Graphics 
  + `{ggplot2}`
* Data manipulations 
  + `{dplyr}`
  + `{tidyr}`
* Expanding area of specialized topics
  + `{lubridate}`
  + `{glue}`
  + `{tidymodels}`
* Many more...

---

# Providing grammar for:

* Graphics 
  + `{ggplot2}`
* Data manipulations
  + .lightblue.bg-yellow[`{dplyr}`]
  + `{tidyr}`
* Expanding area of specialized topics
  + `{lubridate}`
  + `{glue}`
  + `{tidymodels}`
* Many more...


---
class: inverse, left, middle

# {dplyr}

---

# `{dplyr}`

&lt;div&gt;
    &lt;p style="float: right;"&gt;&lt;img src="https://d33wubrfki0l68.cloudfront.net/621a9c8c5d7b47c4b6d72e8f01f28d14310e8370/193fc/css/images/hex/dplyr.png" width="100" height="100"&gt;&lt;/p&gt;
    &lt;p&gt;A grammar for data wrangling (verbs!)&lt;/p&gt;
&lt;/div&gt;

Take a couple minutes with your neighbor to guess what the following functions do:
* `select()`
* `filter()`
* `mutate()`
* `arrange()`
* `summarize()`
* `group_by()`

<div class="countdown" id="timer_877cb742" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">02</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# `{dplyr}`

A grammar for data wrangling (verbs!)

* `select()`

--
  + a subset of **columns**
--

* `filter()`

--
  + a subset of **rows**
--

* `mutate()`

--
  + **add** a new column or **modify** an existing column
--

* `arrange()`

--
  + **sort** rows in ascending/descending order
--

* `summarize()`

--
  + a new column created according to other columns
  + for example: `mean()` or `sd()`
  + often used with...
--

* `group_by()`

--
  + **grouping** column(s)

---
# Arguments

* **`{dplyr}` always takes a data frame (tibble) as the first argument**
  + just like `{ggplot}`


* subsequent functions tell `{dplyr}` what to do with the data frame


* each function applied returns the modified data frame

---
class: inverse, left, middle

# select()

---
# `select()`

### choose columns

.pull-left[

```r
select(df, a, c)
```

-or-


```r
df %&gt;% 
  select(a, c)
```
]

.pull-right[
&lt;img src="https://swcarpentry.github.io/r-novice-gapminder/fig/13-dplyr-fig1.png" width="100%" /&gt;
]

.footnote[
Image from [Software Carpentry](https://swcarpentry.github.io/r-novice-gapminder/fig/13-dplyr-fig1.png)
]

---
# Examples

Letâ€™s start with the presidential dataset from the `{mdsr}` package


```r
library(tidyverse)
#install.packages("mdsr")
library(mdsr)
presidential
```

```
## # A tibble: 11 x 4
##    name       start      end        party     
##    &lt;chr&gt;      &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;     
##  1 Eisenhower 1953-01-20 1961-01-20 Republican
##  2 Kennedy    1961-01-20 1963-11-22 Democratic
##  3 Johnson    1963-11-22 1969-01-20 Democratic
##  4 Nixon      1969-01-20 1974-08-09 Republican
##  5 Ford       1974-08-09 1977-01-20 Republican
##  6 Carter     1977-01-20 1981-01-20 Democratic
##  7 Reagan     1981-01-20 1989-01-20 Republican
##  8 Bush       1989-01-20 1993-01-20 Republican
##  9 Clinton    1993-01-20 2001-01-20 Democratic
## 10 Bush       2001-01-20 2009-01-20 Republican
## 11 Obama      2009-01-20 2017-01-20 Democratic
```

---
# `select` president *name* and *party*


```r
select(presidential, name, party)
```
**OR** more typically

```r
presidential %&gt;%
	select(name, party)
```

```
## # A tibble: 11 x 2
##    name       party     
##    &lt;chr&gt;      &lt;chr&gt;     
##  1 Eisenhower Republican
##  2 Kennedy    Democratic
##  3 Johnson    Democratic
##  4 Nixon      Republican
##  5 Ford       Republican
##  6 Carter     Democratic
##  7 Reagan     Republican
##  8 Bush       Republican
##  9 Clinton    Democratic
## 10 Bush       Republican
## 11 Obama      Democratic
```

---
# Negation `-`

Don't select variable(s)


```r
presidential %&gt;%
	select(-start)
```

```
## # A tibble: 11 x 3
##    name       end        party     
##    &lt;chr&gt;      &lt;date&gt;     &lt;chr&gt;     
##  1 Eisenhower 1961-01-20 Republican
##  2 Kennedy    1963-11-22 Democratic
##  3 Johnson    1969-01-20 Democratic
##  4 Nixon      1974-08-09 Republican
##  5 Ford       1977-01-20 Republican
##  6 Carter     1981-01-20 Democratic
##  7 Reagan     1989-01-20 Republican
##  8 Bush       1993-01-20 Republican
##  9 Clinton    2001-01-20 Democratic
## 10 Bush       2009-01-20 Republican
## 11 Obama      2017-01-20 Democratic
```

---
# Negation `-`

Don't select variable(s)


```r
presidential %&gt;%
	select(-start, -end)
```
**OR**

```r
presidential %&gt;%
	select(-c(start, end))
```

```
## # A tibble: 11 x 2
##    name       party     
##    &lt;chr&gt;      &lt;chr&gt;     
##  1 Eisenhower Republican
##  2 Kennedy    Democratic
##  3 Johnson    Democratic
##  4 Nixon      Republican
##  5 Ford       Republican
##  6 Carter     Democratic
##  7 Reagan     Republican
##  8 Bush       Republican
##  9 Clinton    Democratic
## 10 Bush       Republican
## 11 Obama      Democratic
```
---

# Indexing

Less preferable because variable orders change


```r
select(presidential, 1:3)
```
**OR** more typically

```r
presidential %&gt;%
	select(1:3)
```

```
## # A tibble: 11 x 3
##    name       start      end       
##    &lt;chr&gt;      &lt;date&gt;     &lt;date&gt;    
##  1 Eisenhower 1953-01-20 1961-01-20
##  2 Kennedy    1961-01-20 1963-11-22
##  3 Johnson    1963-11-22 1969-01-20
##  4 Nixon      1969-01-20 1974-08-09
##  5 Ford       1974-08-09 1977-01-20
##  6 Carter     1977-01-20 1981-01-20
##  7 Reagan     1981-01-20 1989-01-20
##  8 Bush       1989-01-20 1993-01-20
##  9 Clinton    1993-01-20 2001-01-20
## 10 Bush       2001-01-20 2009-01-20
## 11 Obama      2009-01-20 2017-01-20
```

---
# Use multiple methods


```r
presidential %&gt;%
	select(name, 2, 4)
```

```
## # A tibble: 11 x 3
##    name       start      party     
##    &lt;chr&gt;      &lt;date&gt;     &lt;chr&gt;     
##  1 Eisenhower 1953-01-20 Republican
##  2 Kennedy    1961-01-20 Democratic
##  3 Johnson    1963-11-22 Democratic
##  4 Nixon      1969-01-20 Republican
##  5 Ford       1974-08-09 Republican
##  6 Carter     1977-01-20 Democratic
##  7 Reagan     1981-01-20 Republican
##  8 Bush       1989-01-20 Republican
##  9 Clinton    1993-01-20 Democratic
## 10 Bush       2001-01-20 Republican
## 11 Obama      2009-01-20 Democratic
```

---
# Use `select` to order columns


```r
library(fivethirtyeight)
college_grad_students
```

```
## # A tibble: 173 x 22
##    major_code major  major~1 grad_~2 grad_~3 grad_~4 grad_~5 grad_~6 grad_~7 grad_~8 grad_~9 grad_~* nongr~* nongr~* nongr~* nongr~*
##         &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;
##  1       5601 Const~ Indust~    9173     200    7098    6511     681  0.0875  110000   75000   53000   86062   73607   62435    3928
##  2       6004 Comme~ Arts      53864     882   40492   29553    2482  0.0578   89000   60000   40000  461977  347166  250596   25484
##  3       6211 Hospi~ Busine~   24417     437   18368   14784    1465  0.0739  100000   65000   45000  179335  145597  113579    7409
##  4       2201 Cosme~ Indust~    5411      72    3590    2701     316  0.0809   85000   47000   24500   37575   29738   23249    1661
##  5       2001 Commu~ Comput~    9109     171    7512    5622     466  0.0584   83700   57000   40600   53819   43163   34231    3389
##  6       3201 Court~ Law &amp; ~    1542      22    1008     860       0  0       120000   75000   55000    8921    6967    6063     518
##  7       6206 Marke~ Busine~  190996    3738  151570  123045    8324  0.0521  120000   80000   50000 1029181  817906  662346   45519
##  8       1101 Agric~ Agricu~   17488     386   13104   11207     473  0.0348  100000   67000   41600   89169   71781   61335    1869
##  9       2101 Compu~ Comput~    5611      98    4716    3981     119  0.0246  114000   85000   56000   28314   22024   18381    2222
## 10       1904 Adver~ Commun~   33928     688   28517   22523     899  0.0306   90000   60000   43000  163435  127832  100330    8706
## # ... with 163 more rows, 6 more variables: nongrad_unemployment_rate &lt;dbl&gt;, nongrad_p25th &lt;dbl&gt;, nongrad_median &lt;dbl&gt;,
## #   nongrad_p75th &lt;dbl&gt;, grad_share &lt;dbl&gt;, grad_premium &lt;dbl&gt;, and abbreviated variable names 1: major_category, 2: grad_total,
## #   3: grad_sample_size, 4: grad_employed, 5: grad_employed_fulltime_yearround, 6: grad_unemployed, 7: grad_unemployment_rate,
## #   8: grad_p25th, 9: grad_median, *: grad_p75th, *: nongrad_total, *: nongrad_employed, *: nongrad_employed_fulltime_yearround,
## #   *: nongrad_unemployed
```

---

# `select()` [helper](https://tidyselect.r-lib.org/reference/select_helpers.html) functions

* `everything()`
* `starts_with()`
* `ends_with()`
* `contains()`
* `all_of()`
* `any_of()`

---
# Helper functions

First: this code may not work for you - why?


```r
reads &lt;- read_csv(here("data", "Project_Reads_Scores.csv")) %&gt;% 
  clean_names()
reads
```

```
## # A tibble: 48 x 25
##    test_year test_~1 test_~2 stude~3 pre_t~4 pre_t~5 post_~6 post_~7 perce~8 unit_~9 unit_~* unit_~* unit_~* unit_~* unit_~* unit_~*
##    &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
##  1 06/01/20~ YEAR E~ VIRDEN  Virden~      43 29%          92 61%     32%           3 12%           4 16%           6 24%           8
##  2 06/01/20~ YEAR E~ VIRDEN  Virden~      46 31%         104 69%     38%           5 20%           5 20%           6 24%           8
##  3 06/01/20~ YEAR E~ VIRDEN  Virden~      39 26%          75 50%     24%           4 16%           4 16%           6 24%           9
##  4 06/01/20~ YEAR E~ VIRDEN  Virden~      35 23%         115 77%     54%           4 16%           4 16%           6 24%          10
##  5 06/01/20~ YEAR E~ VIRDEN  Virden~      46 31%          85 57%     26%           2 8%            5 20%           6 24%           7
##  6 06/01/20~ YEAR E~ VIRDEN  Virden~      35 23%          91 61%     38%           5 20%           5 20%           7 28%           7
##  7 06/01/20~ YEAR E~ VIRDEN  Virden~      40 27%          96 64%     37%           5 20%           5 20%           6 24%           7
##  8 06/01/20~ YEAR E~ VIRDEN  Virden~      39 26%          74 49%     23%           4 16%           5 20%           5 20%           8
##  9 06/01/20~ YEAR E~ VIRDEN  Virden~      40 27%          90 60%     33%           6 24%           4 16%           5 20%           8
## 10 06/01/20~ YEAR E~ VIRDEN  Virden~      45 30%          86 57%     27%           4 16%           5 20%           5 20%           7
## # ... with 38 more rows, 9 more variables: unit_4_percent &lt;chr&gt;, unit_5_6_score &lt;dbl&gt;, unit_5_6_percent &lt;chr&gt;, unit_7_score &lt;dbl&gt;,
## #   unit_7_percent &lt;chr&gt;, unit_8_score &lt;dbl&gt;, unit_8_percent &lt;chr&gt;, total_score &lt;dbl&gt;, total_percent_correct &lt;chr&gt;, and abbreviated
## #   variable names 1: test_type, 2: test_site, 3: student_id, 4: pre_test_score, 5: pre_test_percent, 6: post_test_score,
## #   7: post_test_percent, 8: percentage_change, 9: unit_1_score, *: unit_1_percent, *: unit_2_score, *: unit_2_percent,
## #   *: unit_3_score, *: unit_3_percent, *: unit_4_score
```

---
# Use `select` to order columns


```r
college_grad_students %&gt;%
	select(major_code, grad_total, grad_sample_size, everything())
```

```
## # A tibble: 173 x 22
##    major_code grad_t~1 grad_~2 major major~3 grad_~4 grad_~5 grad_~6 grad_~7 grad_~8 grad_~9 grad_~* nongr~* nongr~* nongr~* nongr~*
##         &lt;int&gt;    &lt;int&gt;   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;
##  1       5601     9173     200 Cons~ Indust~    7098    6511     681  0.0875  110000   75000   53000   86062   73607   62435    3928
##  2       6004    53864     882 Comm~ Arts      40492   29553    2482  0.0578   89000   60000   40000  461977  347166  250596   25484
##  3       6211    24417     437 Hosp~ Busine~   18368   14784    1465  0.0739  100000   65000   45000  179335  145597  113579    7409
##  4       2201     5411      72 Cosm~ Indust~    3590    2701     316  0.0809   85000   47000   24500   37575   29738   23249    1661
##  5       2001     9109     171 Comm~ Comput~    7512    5622     466  0.0584   83700   57000   40600   53819   43163   34231    3389
##  6       3201     1542      22 Cour~ Law &amp; ~    1008     860       0  0       120000   75000   55000    8921    6967    6063     518
##  7       6206   190996    3738 Mark~ Busine~  151570  123045    8324  0.0521  120000   80000   50000 1029181  817906  662346   45519
##  8       1101    17488     386 Agri~ Agricu~   13104   11207     473  0.0348  100000   67000   41600   89169   71781   61335    1869
##  9       2101     5611      98 Comp~ Comput~    4716    3981     119  0.0246  114000   85000   56000   28314   22024   18381    2222
## 10       1904    33928     688 Adve~ Commun~   28517   22523     899  0.0306   90000   60000   43000  163435  127832  100330    8706
## # ... with 163 more rows, 6 more variables: nongrad_unemployment_rate &lt;dbl&gt;, nongrad_p25th &lt;dbl&gt;, nongrad_median &lt;dbl&gt;,
## #   nongrad_p75th &lt;dbl&gt;, grad_share &lt;dbl&gt;, grad_premium &lt;dbl&gt;, and abbreviated variable names 1: grad_total, 2: grad_sample_size,
## #   3: major_category, 4: grad_employed, 5: grad_employed_fulltime_yearround, 6: grad_unemployed, 7: grad_unemployment_rate,
## #   8: grad_p25th, 9: grad_median, *: grad_p75th, *: nongrad_total, *: nongrad_employed, *: nongrad_employed_fulltime_yearround,
## #   *: nongrad_unemployed
```

`everything()` is a helper verb that includes **all** column names

---
# `starts_with()`


```r
reads %&gt;% 
    select(starts_with("test"))
```

```
## # A tibble: 48 x 3
##    test_year              test_type test_site
##    &lt;chr&gt;                  &lt;chr&gt;     &lt;chr&gt;    
##  1 06/01/2016 12:00:00 AM YEAR END  VIRDEN   
##  2 06/01/2016 12:00:00 AM YEAR END  VIRDEN   
##  3 06/01/2016 12:00:00 AM YEAR END  VIRDEN   
##  4 06/01/2016 12:00:00 AM YEAR END  VIRDEN   
##  5 06/01/2016 12:00:00 AM YEAR END  VIRDEN   
##  6 06/01/2016 12:00:00 AM YEAR END  VIRDEN   
##  7 06/01/2016 12:00:00 AM YEAR END  VIRDEN   
##  8 06/01/2016 12:00:00 AM YEAR END  VIRDEN   
##  9 06/01/2016 12:00:00 AM YEAR END  VIRDEN   
## 10 06/01/2016 12:00:00 AM YEAR END  VIRDEN   
## # ... with 38 more rows
```

---
# `ends_with()`


```r
reads %&gt;% 
    select(ends_with("score"))
```

```
## # A tibble: 48 x 10
##    pre_test_score post_test_score unit_1_score unit_2_score unit_3_score unit_4_score unit_5_6_score unit_7_score unit_8_s~1 total~2
##             &lt;dbl&gt;           &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;
##  1             43              92            3            4            6            8             11           22         18     207
##  2             46             104            5            5            6            8             11           20         19     224
##  3             39              75            4            4            6            9             16           19         21     193
##  4             35             115            4            4            6           10             13           18         18     223
##  5             46              85            2            5            6            7             12           19         16     198
##  6             35              91            5            5            7            7             18           23         19     210
##  7             40              96            5            5            6            7             11           21         20     211
##  8             39              74            4            5            5            8             12           16         17     180
##  9             40              90            6            4            5            8             15           18         20     206
## 10             45              86            4            5            5            7             14           21         19     206
## # ... with 38 more rows, and abbreviated variable names 1: unit_8_score, 2: total_score
```

---
# `contains()`


```r
reads %&gt;% 
    select(contains("test"))
```

```
## # A tibble: 48 x 7
##    test_year              test_type test_site pre_test_score pre_test_percent post_test_score post_test_percent
##    &lt;chr&gt;                  &lt;chr&gt;     &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;                      &lt;dbl&gt; &lt;chr&gt;            
##  1 06/01/2016 12:00:00 AM YEAR END  VIRDEN                43 29%                           92 61%              
##  2 06/01/2016 12:00:00 AM YEAR END  VIRDEN                46 31%                          104 69%              
##  3 06/01/2016 12:00:00 AM YEAR END  VIRDEN                39 26%                           75 50%              
##  4 06/01/2016 12:00:00 AM YEAR END  VIRDEN                35 23%                          115 77%              
##  5 06/01/2016 12:00:00 AM YEAR END  VIRDEN                46 31%                           85 57%              
##  6 06/01/2016 12:00:00 AM YEAR END  VIRDEN                35 23%                           91 61%              
##  7 06/01/2016 12:00:00 AM YEAR END  VIRDEN                40 27%                           96 64%              
##  8 06/01/2016 12:00:00 AM YEAR END  VIRDEN                39 26%                           74 49%              
##  9 06/01/2016 12:00:00 AM YEAR END  VIRDEN                40 27%                           90 60%              
## 10 06/01/2016 12:00:00 AM YEAR END  VIRDEN                45 30%                           86 57%              
## # ... with 38 more rows
```

---
# `all_of()`


```r
vars &lt;- c("pre_test_score", "pre_test_percent", "post_test_score", "post_test_percent")
```


```r
reads %&gt;% 
    select(all_of(vars))
```

```
## # A tibble: 48 x 4
##    pre_test_score pre_test_percent post_test_score post_test_percent
##             &lt;dbl&gt; &lt;chr&gt;                      &lt;dbl&gt; &lt;chr&gt;            
##  1             43 29%                           92 61%              
##  2             46 31%                          104 69%              
##  3             39 26%                           75 50%              
##  4             35 23%                          115 77%              
##  5             46 31%                           85 57%              
##  6             35 23%                           91 61%              
##  7             40 27%                           96 64%              
##  8             39 26%                           74 49%              
##  9             40 27%                           90 60%              
## 10             45 30%                           86 57%              
## # ... with 38 more rows
```

---
# `all_of()`


```r
vars &lt;- c("pre_test_score", "pre_test_percent", "post_test_score", "post_test_percent")
```


```r
*mpg %&gt;%
    select(all_of(vars))
```

```
## Error in `select()`:
## ! Can't subset columns that don't exist.
## x Columns `pre_test_score`, `pre_test_percent`, `post_test_score`, and `post_test_percent` don't exist.
```

---
# `any_of()`


```r
vars &lt;- c("pre_test_score", "pre_test_percent", "post_test_score", "post_test_percent")
```


```r
reads %&gt;% 
    select(any_of(vars))
```

```
## # A tibble: 48 x 4
##    pre_test_score pre_test_percent post_test_score post_test_percent
##             &lt;dbl&gt; &lt;chr&gt;                      &lt;dbl&gt; &lt;chr&gt;            
##  1             43 29%                           92 61%              
##  2             46 31%                          104 69%              
##  3             39 26%                           75 50%              
##  4             35 23%                          115 77%              
##  5             46 31%                           85 57%              
##  6             35 23%                           91 61%              
##  7             40 27%                           96 64%              
##  8             39 26%                           74 49%              
##  9             40 27%                           90 60%              
## 10             45 30%                           86 57%              
## # ... with 38 more rows
```

---
# `any_of()`


```r
vars &lt;- c("pre_test_score", "pre_test_percent", "post_test_score", "post_test_percent")
```


```r
*mpg %&gt;%
    select(any_of(vars))
```

```
## # A tibble: 234 x 0
```

---
# Mix `select` methods and helpers

You can mix types and helper functions


```r
reads %&gt;% 
    select(student_id, 1, starts_with("total"))
```

```
## # A tibble: 48 x 4
##    student_id test_year              total_score total_percent_correct
##    &lt;chr&gt;      &lt;chr&gt;                        &lt;dbl&gt; &lt;chr&gt;                
##  1 Virden 1   06/01/2016 12:00:00 AM         207 41%                  
##  2 Virden 2   06/01/2016 12:00:00 AM         224 45%                  
##  3 Virden 3   06/01/2016 12:00:00 AM         193 39%                  
##  4 Virden 4   06/01/2016 12:00:00 AM         223 45%                  
##  5 Virden 5   06/01/2016 12:00:00 AM         198 40%                  
##  6 Virden 6   06/01/2016 12:00:00 AM         210 42%                  
##  7 Virden 7   06/01/2016 12:00:00 AM         211 42%                  
##  8 Virden 8   06/01/2016 12:00:00 AM         180 36%                  
##  9 Virden 9   06/01/2016 12:00:00 AM         206 41%                  
## 10 Virden 10  06/01/2016 12:00:00 AM         206 41%                  
## # ... with 38 more rows
```

---
# Mix `select` methods and helpers

You can also use select to rearrange your columns


```r
reads %&gt;% 
    select(student_id, 1, starts_with("total"), everything())
```

```
## # A tibble: 48 x 25
##    student~1 test_~2 total~3 total~4 test_~5 test_~6 pre_t~7 pre_t~8 post_~9 post_~* perce~* unit_~* unit_~* unit_~* unit_~* unit_~*
##    &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
##  1 Virden 1  06/01/~     207 41%     YEAR E~ VIRDEN       43 29%          92 61%     32%           3 12%           4 16%           6
##  2 Virden 2  06/01/~     224 45%     YEAR E~ VIRDEN       46 31%         104 69%     38%           5 20%           5 20%           6
##  3 Virden 3  06/01/~     193 39%     YEAR E~ VIRDEN       39 26%          75 50%     24%           4 16%           4 16%           6
##  4 Virden 4  06/01/~     223 45%     YEAR E~ VIRDEN       35 23%         115 77%     54%           4 16%           4 16%           6
##  5 Virden 5  06/01/~     198 40%     YEAR E~ VIRDEN       46 31%          85 57%     26%           2 8%            5 20%           6
##  6 Virden 6  06/01/~     210 42%     YEAR E~ VIRDEN       35 23%          91 61%     38%           5 20%           5 20%           7
##  7 Virden 7  06/01/~     211 42%     YEAR E~ VIRDEN       40 27%          96 64%     37%           5 20%           5 20%           6
##  8 Virden 8  06/01/~     180 36%     YEAR E~ VIRDEN       39 26%          74 49%     23%           4 16%           5 20%           5
##  9 Virden 9  06/01/~     206 41%     YEAR E~ VIRDEN       40 27%          90 60%     33%           6 24%           4 16%           5
## 10 Virden 10 06/01/~     206 41%     YEAR E~ VIRDEN       45 30%          86 57%     27%           4 16%           5 20%           5
## # ... with 38 more rows, 9 more variables: unit_3_percent &lt;chr&gt;, unit_4_score &lt;dbl&gt;, unit_4_percent &lt;chr&gt;, unit_5_6_score &lt;dbl&gt;,
## #   unit_5_6_percent &lt;chr&gt;, unit_7_score &lt;dbl&gt;, unit_7_percent &lt;chr&gt;, unit_8_score &lt;dbl&gt;, unit_8_percent &lt;chr&gt;, and abbreviated
## #   variable names 1: student_id, 2: test_year, 3: total_score, 4: total_percent_correct, 5: test_type, 6: test_site,
## #   7: pre_test_score, 8: pre_test_percent, 9: post_test_score, *: post_test_percent, *: percentage_change, *: unit_1_score,
## #   *: unit_1_percent, *: unit_2_score, *: unit_2_percent, *: unit_3_score
```

---
# `relocate()`

.darkorange[relocate(].lightblue[.data], ... .green[before = NULL], .lightorange[.after = NULL].darkorange[)]

.lightblue[.data] = dataframe/tibble

... = columns to move

.green[.before] = variable to move *before*

.lightorange[.after] = variable to move *after*

- supplying neither .green[.before] nor .lightorange[.after] move columns to the left-hand side

- specifying both is an error

---

# `relocate()`


```r
presidential %&gt;% 
  relocate(party)
```

```
## # A tibble: 11 x 4
##    party      name       start      end       
##    &lt;chr&gt;      &lt;chr&gt;      &lt;date&gt;     &lt;date&gt;    
##  1 Republican Eisenhower 1953-01-20 1961-01-20
##  2 Democratic Kennedy    1961-01-20 1963-11-22
##  3 Democratic Johnson    1963-11-22 1969-01-20
##  4 Republican Nixon      1969-01-20 1974-08-09
##  5 Republican Ford       1974-08-09 1977-01-20
##  6 Democratic Carter     1977-01-20 1981-01-20
##  7 Republican Reagan     1981-01-20 1989-01-20
##  8 Republican Bush       1989-01-20 1993-01-20
##  9 Democratic Clinton    1993-01-20 2001-01-20
## 10 Republican Bush       2001-01-20 2009-01-20
## 11 Democratic Obama      2009-01-20 2017-01-20
```

.footnote[
#### moves "party" to far left (default)
]

---

# `relocate()`


```r
presidential %&gt;% 
  relocate(party, .after = start)
```

```
## # A tibble: 11 x 4
##    name       start      party      end       
##    &lt;chr&gt;      &lt;date&gt;     &lt;chr&gt;      &lt;date&gt;    
##  1 Eisenhower 1953-01-20 Republican 1961-01-20
##  2 Kennedy    1961-01-20 Democratic 1963-11-22
##  3 Johnson    1963-11-22 Democratic 1969-01-20
##  4 Nixon      1969-01-20 Republican 1974-08-09
##  5 Ford       1974-08-09 Republican 1977-01-20
##  6 Carter     1977-01-20 Democratic 1981-01-20
##  7 Reagan     1981-01-20 Republican 1989-01-20
##  8 Bush       1989-01-20 Republican 1993-01-20
##  9 Clinton    1993-01-20 Democratic 2001-01-20
## 10 Bush       2001-01-20 Republican 2009-01-20
## 11 Obama      2009-01-20 Democratic 2017-01-20
```

.footnote[
#### moves "party" after "start"
]

---

# `relocate()`


```r
presidential %&gt;% 
  relocate(end, .before = party)
```

```
## # A tibble: 11 x 4
##    name       start      end        party     
##    &lt;chr&gt;      &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;     
##  1 Eisenhower 1953-01-20 1961-01-20 Republican
##  2 Kennedy    1961-01-20 1963-11-22 Democratic
##  3 Johnson    1963-11-22 1969-01-20 Democratic
##  4 Nixon      1969-01-20 1974-08-09 Republican
##  5 Ford       1974-08-09 1977-01-20 Republican
##  6 Carter     1977-01-20 1981-01-20 Democratic
##  7 Reagan     1981-01-20 1989-01-20 Republican
##  8 Bush       1989-01-20 1993-01-20 Republican
##  9 Clinton    1993-01-20 2001-01-20 Democratic
## 10 Bush       2001-01-20 2009-01-20 Republican
## 11 Obama      2009-01-20 2017-01-20 Democratic
```

.footnote[
#### moves "end" before "party"
]

---
class: inverse, left, middle

# filter()

---
# `filter()`

.darkblue[**choose rows**] that satisfy your condition (== `TRUE`)

.pull-left[

```r
filter(df,
       type == "otter",
       site == "bay")
```
]

.pull-right[
&lt;img src="https://raw.githubusercontent.com/allisonhorst/stats-illustrations/master/rstats-artwork/dplyr_filter.jpg" width="100%" style="display: block; margin: auto;" /&gt;
]

.footnote[
Illustration by [Allison Horst](https://github.com/allisonhorst/stats-illustrations/)
]

---
# `filter()`

.pull-left[
Complete set of boolean operations
- *x* is the left-hand circle
- *y* is the right-hand circle
- the shaded region show which parts each operator selects
  + *xor* == *x* or *y* except where they overlap

**==** - equal

**!** - negates

**!=** - NOT equal

**&amp;** - and

**|** - or
]

.pull-right[
&lt;img src="https://d33wubrfki0l68.cloudfront.net/01f4b6d39d2be8269740a3ad7946faa79f7243cf/8369a/diagrams/transform-logical.png" width="100%" /&gt;
]

.footnote[
Image from [Wickham &amp; Grolemund (2017)](https://r4ds.had.co.nz/transform.html?q=filter#filter-rows-with-filter)
]

---
# `filter()` numeric

* note the use of `==` NOT `=`

.pull-left[

```r
mpg %&gt;% 
  filter(cyl == 4)
```

```
## # A tibble: 81 x 11
##    manufacturer model      displ  year   cyl trans      drv     cty   hwy fl    class  
##    &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  
##  1 audi         a4           1.8  1999     4 auto(l5)   f        18    29 p     compact
##  2 audi         a4           1.8  1999     4 manual(m5) f        21    29 p     compact
##  3 audi         a4           2    2008     4 manual(m6) f        20    31 p     compact
##  4 audi         a4           2    2008     4 auto(av)   f        21    30 p     compact
##  5 audi         a4 quattro   1.8  1999     4 manual(m5) 4        18    26 p     compact
##  6 audi         a4 quattro   1.8  1999     4 auto(l5)   4        16    25 p     compact
##  7 audi         a4 quattro   2    2008     4 manual(m6) 4        20    28 p     compact
##  8 audi         a4 quattro   2    2008     4 auto(s6)   4        19    27 p     compact
##  9 chevrolet    malibu       2.4  1999     4 auto(l4)   f        19    27 r     midsize
## 10 chevrolet    malibu       2.4  2008     4 auto(l4)   f        22    30 r     midsize
## # ... with 71 more rows
```
]

.pull-right[

```r
mpg %&gt;% 
  filter(hwy &gt;= 22)
```

```
## # A tibble: 143 x 11
##    manufacturer model      displ  year   cyl trans      drv     cty   hwy fl    class  
##    &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  
##  1 audi         a4           1.8  1999     4 auto(l5)   f        18    29 p     compact
##  2 audi         a4           1.8  1999     4 manual(m5) f        21    29 p     compact
##  3 audi         a4           2    2008     4 manual(m6) f        20    31 p     compact
##  4 audi         a4           2    2008     4 auto(av)   f        21    30 p     compact
##  5 audi         a4           2.8  1999     6 auto(l5)   f        16    26 p     compact
##  6 audi         a4           2.8  1999     6 manual(m5) f        18    26 p     compact
##  7 audi         a4           3.1  2008     6 auto(av)   f        18    27 p     compact
##  8 audi         a4 quattro   1.8  1999     4 manual(m5) 4        18    26 p     compact
##  9 audi         a4 quattro   1.8  1999     4 auto(l5)   4        16    25 p     compact
## 10 audi         a4 quattro   2    2008     4 manual(m6) 4        20    28 p     compact
## # ... with 133 more rows
```
]

---
# `filter` for Democrats

* note the use of `==` NOT `=`

.pull-left[

```r
presidential %&gt;%
	filter(party == "Democratic")
```

```
## # A tibble: 5 x 4
##   name    start      end        party     
##   &lt;chr&gt;   &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;     
## 1 Kennedy 1961-01-20 1963-11-22 Democratic
## 2 Johnson 1963-11-22 1969-01-20 Democratic
## 3 Carter  1977-01-20 1981-01-20 Democratic
## 4 Clinton 1993-01-20 2001-01-20 Democratic
## 5 Obama   2009-01-20 2017-01-20 Democratic
```
]

.pull-right[

```r
presidential %&gt;%
	filter(party = "Democratic")
```

```
## Error in `filter()`:
## ! We detected a named input.
## i This usually means that you've used `=` instead of `==`.
## i Did you mean `party == "Democratic"`?
```
]

---
# `filter` character

* note the use of `==` NOT `=`




.pull-left[

```r
mpg_ %&gt;% 
  filter(manufacturer == "pontiac")
```

```
## # A tibble: 5 x 5
##   manufacturer model      displ  year   cyl
##   &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
## 1 pontiac      grand prix   3.1  1999     6
## 2 pontiac      grand prix   3.8  1999     6
## 3 pontiac      grand prix   3.8  1999     6
## 4 pontiac      grand prix   3.8  2008     6
## 5 pontiac      grand prix   5.3  2008     8
```
]

.pull-right[

```r
presidential %&gt;% 
  filter(party == "Democratic")
```

```
## # A tibble: 5 x 4
##   name    start      end        party     
##   &lt;chr&gt;   &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;     
## 1 Kennedy 1961-01-20 1963-11-22 Democratic
## 2 Johnson 1963-11-22 1969-01-20 Democratic
## 3 Carter  1977-01-20 1981-01-20 Democratic
## 4 Clinton 1993-01-20 2001-01-20 Democratic
## 5 Obama   2009-01-20 2017-01-20 Democratic
```
]

---
# Democrats starting after 2000

`,` is equivalent to `&amp;`

.pull-left[

```r
presidential %&gt;% 
  filter(party == "Democratic" &amp; 
  start &gt; "2000-01-01")
```

```
## # A tibble: 1 x 4
##   name  start      end        party     
##   &lt;chr&gt; &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;     
## 1 Obama 2009-01-20 2017-01-20 Democratic
```
]

.pull-right[

```r
presidential %&gt;% 
  filter(party == "Democratic", 
  start &gt; "2000-01-01")
```

```
## # A tibble: 1 x 4
##   name  start      end        party     
##   &lt;chr&gt; &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;     
## 1 Obama 2009-01-20 2017-01-20 Democratic
```
]

---
# `filter()` note

* The order of operations doesnâ€™t work like English

* Canâ€™t write: 
  + `filter(presidential, name == "Kennedy" | "Johnson")`

* Must be:
  + `filter(presidential, name == "Kennedy" | name == "Johnson")`

---
# more `filter()`


```r
reads
```

```
## # A tibble: 48 x 25
##    test_year test_~1 test_~2 stude~3 pre_t~4 pre_t~5 post_~6 post_~7 perce~8 unit_~9 unit_~* unit_~* unit_~* unit_~* unit_~* unit_~*
##    &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
##  1 06/01/20~ YEAR E~ VIRDEN  Virden~      43 29%          92 61%     32%           3 12%           4 16%           6 24%           8
##  2 06/01/20~ YEAR E~ VIRDEN  Virden~      46 31%         104 69%     38%           5 20%           5 20%           6 24%           8
##  3 06/01/20~ YEAR E~ VIRDEN  Virden~      39 26%          75 50%     24%           4 16%           4 16%           6 24%           9
##  4 06/01/20~ YEAR E~ VIRDEN  Virden~      35 23%         115 77%     54%           4 16%           4 16%           6 24%          10
##  5 06/01/20~ YEAR E~ VIRDEN  Virden~      46 31%          85 57%     26%           2 8%            5 20%           6 24%           7
##  6 06/01/20~ YEAR E~ VIRDEN  Virden~      35 23%          91 61%     38%           5 20%           5 20%           7 28%           7
##  7 06/01/20~ YEAR E~ VIRDEN  Virden~      40 27%          96 64%     37%           5 20%           5 20%           6 24%           7
##  8 06/01/20~ YEAR E~ VIRDEN  Virden~      39 26%          74 49%     23%           4 16%           5 20%           5 20%           8
##  9 06/01/20~ YEAR E~ VIRDEN  Virden~      40 27%          90 60%     33%           6 24%           4 16%           5 20%           8
## 10 06/01/20~ YEAR E~ VIRDEN  Virden~      45 30%          86 57%     27%           4 16%           5 20%           5 20%           7
## # ... with 38 more rows, 9 more variables: unit_4_percent &lt;chr&gt;, unit_5_6_score &lt;dbl&gt;, unit_5_6_percent &lt;chr&gt;, unit_7_score &lt;dbl&gt;,
## #   unit_7_percent &lt;chr&gt;, unit_8_score &lt;dbl&gt;, unit_8_percent &lt;chr&gt;, total_score &lt;dbl&gt;, total_percent_correct &lt;chr&gt;, and abbreviated
## #   variable names 1: test_type, 2: test_site, 3: student_id, 4: pre_test_score, 5: pre_test_percent, 6: post_test_score,
## #   7: post_test_percent, 8: percentage_change, 9: unit_1_score, *: unit_1_percent, *: unit_2_score, *: unit_2_percent,
## #   *: unit_3_score, *: unit_3_percent, *: unit_4_score
```

---
# more `filter()`

Anomaly in the data


```r
reads %&gt;%
 count(student_id)
```

```
## # A tibble: 46 x 2
##    student_id                 n
##    &lt;chr&gt;                  &lt;int&gt;
*##  1 All Students (Average)     3
##  2 Jones 1                    1
##  3 Jones 10                   1
##  4 Jones 11                   1
##  5 Jones 12                   1
##  6 Jones 13                   1
##  7 Jones 14                   1
##  8 Jones 15                   1
##  9 Jones 2                    1
## 10 Jones 3                    1
## # ... with 36 more rows
```

---
# Let's remove these aggregate rows


```r
students_only &lt;- reads %&gt;%
  filter(student_id != "All Students (Average)") 

students_only %&gt;% 
  count(student_id)
```

```
## # A tibble: 45 x 2
##    student_id     n
##    &lt;chr&gt;      &lt;int&gt;
##  1 Jones 1        1
##  2 Jones 10       1
##  3 Jones 11       1
##  4 Jones 12       1
##  5 Jones 13       1
##  6 Jones 14       1
##  7 Jones 15       1
##  8 Jones 2        1
##  9 Jones 3        1
## 10 Jones 4        1
## # ... with 35 more rows
```

---
# Not equal 

`!=` means *NOT equal*

`!` means **NOT**


Note:
- If you want values that are NOT `NA`:
  + `!is.na(variable)`
  + ~~`variable != NA`~~

---
# Chaining `{dplyr}` functions

What if we wanted to `select` and `filter` a data set?

* Select "*name*" and "*party*" of presidents who began their term after 2000

(1) Two step method


```r
after_2000 &lt;- filter(presidential, start &gt; as.Date("2000-01-01"))
select(after_2000, name, party)
```

```
## # A tibble: 2 x 2
##   name  party     
##   &lt;chr&gt; &lt;chr&gt;     
## 1 Bush  Republican
## 2 Obama Democratic
```

---
# Chaining `{dplyr}` functions

(2) Alternatively, we could wrap `select` around `filter`


```r
select(filter(presidential, start &gt; as.Date("2000-01-01")), name, party)
```

```
## # A tibble: 2 x 2
##   name  party     
##   &lt;chr&gt; &lt;chr&gt;     
## 1 Bush  Republican
## 2 Obama Democratic
```

---
# Chaining `{dplyr}` functions

#### (3) Piping functions ðŸŽ‰

* We could use the piple function to help increase the readability of our code: 
&lt;br&gt;
`%&gt;%`
&lt;br&gt;

* Called the "pipe" operator and "piping functions"


```r
filter(presidential, start &gt; as.Date("2000-01-01")) %&gt;% 
  select(name, party)
```

```
## # A tibble: 2 x 2
##   name  party     
##   &lt;chr&gt; &lt;chr&gt;     
## 1 Bush  Republican
## 2 Obama Democratic
```

---
# Piping functions

Even better:

* Generally when using the pipe, the first argument is the data set, which gets piped through the corresponding functions
* So the code on the prior slide would be:


```r
presidential %&gt;% 
  filter(start &gt; as.Date("2000-01-01")) %&gt;% 
  select(name, party)
```

```
## # A tibble: 2 x 2
##   name  party     
##   &lt;chr&gt; &lt;chr&gt;     
## 1 Bush  Republican
## 2 Obama Democratic
```

.footnote[
Note the lovely indentations and line breaks to help keep things straight
]

---
class: inverse, left, middle

# mutate()

---
# Some new data


```r
(prepost &lt;- reads %&gt;% 
  select(student_id, test_site, pre_test_score, post_test_score))
```

```
## # A tibble: 48 x 4
##    student_id test_site pre_test_score post_test_score
##    &lt;chr&gt;      &lt;chr&gt;              &lt;dbl&gt;           &lt;dbl&gt;
##  1 Virden 1   VIRDEN                43              92
##  2 Virden 2   VIRDEN                46             104
##  3 Virden 3   VIRDEN                39              75
##  4 Virden 4   VIRDEN                35             115
##  5 Virden 5   VIRDEN                46              85
##  6 Virden 6   VIRDEN                35              91
##  7 Virden 7   VIRDEN                40              96
##  8 Virden 8   VIRDEN                39              74
##  9 Virden 9   VIRDEN                40              90
## 10 Virden 10  VIRDEN                45              86
## # ... with 38 more rows
```

---
# `mutate()`

**Add** a variable


```r
prepost %&gt;% 
* mutate(gain = post_test_score - pre_test_score)
```

```
## # A tibble: 48 x 5
##    student_id test_site pre_test_score post_test_score  gain
##    &lt;chr&gt;      &lt;chr&gt;              &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt;
##  1 Virden 1   VIRDEN                43              92    49
##  2 Virden 2   VIRDEN                46             104    58
##  3 Virden 3   VIRDEN                39              75    36
##  4 Virden 4   VIRDEN                35             115    80
##  5 Virden 5   VIRDEN                46              85    39
##  6 Virden 6   VIRDEN                35              91    56
##  7 Virden 7   VIRDEN                40              96    56
##  8 Virden 8   VIRDEN                39              74    35
##  9 Virden 9   VIRDEN                40              90    50
## 10 Virden 10  VIRDEN                45              86    41
## # ... with 38 more rows
```

---


```r
names(prepost)
```

```
## [1] "student_id"      "test_site"       "pre_test_score"  "post_test_score"
```

--



Why do we not see the new *gain* column?

---
# `mutate()`

**Add** *multiple* variables


```r
prepost &lt;- prepost %&gt;%
  mutate(
    gain = post_test_score - pre_test_score,
	  sum_tests = post_test_score + pre_test_score
  )

prepost
```

```
## # A tibble: 48 x 6
##    student_id test_site pre_test_score post_test_score  gain sum_tests
##    &lt;chr&gt;      &lt;chr&gt;              &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 Virden 1   VIRDEN                43              92    49       135
##  2 Virden 2   VIRDEN                46             104    58       150
##  3 Virden 3   VIRDEN                39              75    36       114
##  4 Virden 4   VIRDEN                35             115    80       150
##  5 Virden 5   VIRDEN                46              85    39       131
##  6 Virden 6   VIRDEN                35              91    56       126
##  7 Virden 7   VIRDEN                40              96    56       136
##  8 Virden 8   VIRDEN                39              74    35       113
##  9 Virden 9   VIRDEN                40              90    50       130
## 10 Virden 10  VIRDEN                45              86    41       131
## # ... with 38 more rows
```

---
# `mutate()`

**Change** a variable


```r
prepost &lt;- prepost %&gt;% 
  mutate(sum_tests = (sum_tests/180) * 100)

prepost
```

```
## # A tibble: 48 x 6
##    student_id test_site pre_test_score post_test_score  gain sum_tests
##    &lt;chr&gt;      &lt;chr&gt;              &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 Virden 1   VIRDEN                43              92    49      75  
##  2 Virden 2   VIRDEN                46             104    58      83.3
##  3 Virden 3   VIRDEN                39              75    36      63.3
##  4 Virden 4   VIRDEN                35             115    80      83.3
##  5 Virden 5   VIRDEN                46              85    39      72.8
##  6 Virden 6   VIRDEN                35              91    56      70  
##  7 Virden 7   VIRDEN                40              96    56      75.6
##  8 Virden 8   VIRDEN                39              74    35      62.8
##  9 Virden 9   VIRDEN                40              90    50      72.2
## 10 Virden 10  VIRDEN                45              86    41      72.8
## # ... with 38 more rows
```

---
class: inverse, left, middle

# arrange()

---
# `arrange()`

#### Order the data

* Order by *gain*, ascending [default]


```r
prepost %&gt;% 
  arrange(gain)
```

```
## # A tibble: 48 x 6
##    student_id  test_site pre_test_score post_test_score  gain sum_tests
##    &lt;chr&gt;       &lt;chr&gt;              &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 Jones 12    JONES                 27              32     5      32.8
##  2 Westside 6  WESTSIDE              57              82    25      77.2
##  3 Virden 8    VIRDEN                39              74    35      62.8
##  4 Virden 3    VIRDEN                39              75    36      63.3
##  5 Virden 5    VIRDEN                46              85    39      72.8
##  6 Virden 10   VIRDEN                45              86    41      72.8
##  7 Jones 3     JONES                 54              95    41      82.8
##  8 Virden 1    VIRDEN                43              92    49      75  
##  9 Jones 13    JONES                 49              98    49      81.7
## 10 Westside 13 WESTSIDE              45              94    49      77.2
## # ... with 38 more rows
```

---
# `arrange()`

#### Order the data

* Order by *pre_test_score* and *gain*, ascending


```r
prepost %&gt;% 
  arrange(pre_test_score, gain)
```

```
## # A tibble: 48 x 6
##    student_id test_site pre_test_score post_test_score  gain sum_tests
##    &lt;chr&gt;      &lt;chr&gt;              &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 Jones 11   JONES                 24             108    84      73.3
##  2 Jones 4    JONES                 25              99    74      68.9
##  3 Jones 12   JONES                 27              32     5      32.8
##  4 Virden 12  VIRDEN                31             102    71      73.9
##  5 Virden 11  VIRDEN                32              91    59      68.3
##  6 Virden 13  VIRDEN                33              86    53      66.1
##  7 Virden 6   VIRDEN                35              91    56      70  
##  8 Virden 15  VIRDEN                35             101    66      75.6
##  9 Jones 9    JONES                 35             109    74      80  
## 10 Virden 4   VIRDEN                35             115    80      83.3
## # ... with 38 more rows
```

---
# `arrange()`

#### Order the data

* Order by *gain*, `desc`ending


```r
prepost %&gt;% 
  arrange(desc(gain))
```

```
## # A tibble: 48 x 6
##    student_id test_site pre_test_score post_test_score  gain sum_tests
##    &lt;chr&gt;      &lt;chr&gt;              &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 Jones 11   JONES                 24             108    84      73.3
##  2 Virden 4   VIRDEN                35             115    80      83.3
##  3 Jones 4    JONES                 25              99    74      68.9
##  4 Jones 5    JONES                 36             110    74      81.1
##  5 Jones 9    JONES                 35             109    74      80  
##  6 Virden 12  VIRDEN                31             102    71      73.9
##  7 Jones 1    JONES                 36             103    67      77.2
##  8 Virden 15  VIRDEN                35             101    66      75.6
##  9 Jones 6    JONES                 40             106    66      81.1
## 10 Westside 8 WESTSIDE              43             109    66      84.4
## # ... with 38 more rows
```

---
class: inverse, left, middle

# summarize()

---
# `summarize()`

#### or `summarise()`

* Here: compute the `mean` and `standard deviation` of the gain scores
* What are we looking at?


```r
prepost %&gt;% 
  summarize(mean_gain = mean(gain, na.rm = TRUE),
            sd_gain = sd(gain, na.rm = TRUE))
```

```
## # A tibble: 1 x 2
##   mean_gain sd_gain
##       &lt;dbl&gt;   &lt;dbl&gt;
## 1      56.3    13.6
```

--

.footnote[
This is a good start for a descriptive table!
]

---
class: inverse, left, middle

# group_by()

---
.pull-left[
&lt;img src="https://swcarpentry.github.io/r-novice-gapminder/fig/13-dplyr-fig2.png" width="100%" /&gt;

]

--

.pull-right[
&lt;img src="https://swcarpentry.github.io/r-novice-gapminder/fig/13-dplyr-fig3.png" width="100%" /&gt;
]

.footnote[
Image from [Software Carpentry](https://swcarpentry.github.io/r-novice-gapminder/13-dplyr/)
]

---
# `group_by()`

&lt;b&gt;Conduct an operation for each level of a grouping factor&lt;/b&gt;

Here, compute the mean gain for each *test site*


```r
prepost %&gt;% 
  group_by(test_site) %&gt;% 
  summarize(mean_gain = mean(gain))
```

```
## # A tibble: 6 x 2
##   test_site    mean_gain
##   &lt;chr&gt;            &lt;dbl&gt;
## 1 JONES             59  
## 2 JONES ALL         59  
## 3 VIRDEN            53.8
## 4 VIRDEN ALL        53  
## 5 WESTSIDE          56.3
## 6 WESTSIDE ALL      56
```

---
# `group_by()`

#### When you use `group_by()` and `summarize()`

.pull-left[
You will get a row for each unique group

```r
mpg %&gt;% 
  group_by(cyl) %&gt;% 
  summarize(max_hwy = max(hwy))
```

```
## # A tibble: 4 x 2
##     cyl max_hwy
##   &lt;int&gt;   &lt;int&gt;
## 1     4      44
## 2     5      29
## 3     6      29
## 4     8      26
```
]

--

.pull-right[
If you have multiple grouping variables, you will get a row for each unique combination of groups

```r
mpg %&gt;% 
  group_by(cyl, drv) %&gt;% 
  summarize(max_hwy = max(hwy))
```

```
## # A tibble: 9 x 3
## # Groups:   cyl [4]
##     cyl drv   max_hwy
##   &lt;int&gt; &lt;chr&gt;   &lt;int&gt;
## 1     4 4          28
## 2     4 f          44
## 3     5 f          29
## 4     6 4          25
## 5     6 f          29
## 6     6 r          26
## 7     8 4          23
## 8     8 f          25
## 9     8 r          26
```
]

---
# Add summarized column to full data

#### Use `mutate()`!


```r
prepost %&gt;% 
  group_by(test_site) %&gt;% 
  mutate(mean_gain = mean(gain))
```

```
## # A tibble: 48 x 7
## # Groups:   test_site [6]
##    student_id test_site pre_test_score post_test_score  gain sum_tests mean_gain
##    &lt;chr&gt;      &lt;chr&gt;              &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 Virden 1   VIRDEN                43              92    49      75        53.8
##  2 Virden 2   VIRDEN                46             104    58      83.3      53.8
##  3 Virden 3   VIRDEN                39              75    36      63.3      53.8
##  4 Virden 4   VIRDEN                35             115    80      83.3      53.8
##  5 Virden 5   VIRDEN                46              85    39      72.8      53.8
##  6 Virden 6   VIRDEN                35              91    56      70        53.8
##  7 Virden 7   VIRDEN                40              96    56      75.6      53.8
##  8 Virden 8   VIRDEN                39              74    35      62.8      53.8
##  9 Virden 9   VIRDEN                40              90    50      72.2      53.8
## 10 Virden 10  VIRDEN                45              86    41      72.8      53.8
## # ... with 38 more rows
```

---
# Retain only summarized columns

#### Use `summarize()`!


```r
prepost %&gt;% 
  group_by(test_site) %&gt;% 
  summarize(mean_gain = mean(gain))
```

```
## # A tibble: 6 x 2
##   test_site    mean_gain
##   &lt;chr&gt;            &lt;dbl&gt;
## 1 JONES             59  
## 2 JONES ALL         59  
## 3 VIRDEN            53.8
## 4 VIRDEN ALL        53  
## 5 WESTSIDE          56.3
## 6 WESTSIDE ALL      56
```

---
# Pipe to `{ggplot}`!


```r
prepost %&gt;% 
  group_by(test_site) %&gt;% 
  summarize(mean_gain = mean(gain)) %&gt;% 
* ggplot(aes(test_site, mean_gain)) +
* geom_col(fill = "cornflowerblue", alpha = .7)
```

&lt;img src="w4_dplyr_files/figure-html/unnamed-chunk-68-1.png" width="100%" /&gt;

---

background-size: contain

background-image: url("./images/kd.gif")

---
# Summarizing and Plotting

* Calculate mean *post_test_score* by test site


```r
students_only %&gt;%
    group_by(test_site) %&gt;%
    summarize(mean = mean(post_test_score))
```

```
## # A tibble: 3 x 2
##   test_site  mean
##   &lt;chr&gt;     &lt;dbl&gt;
## 1 JONES      97.8
## 2 VIRDEN     92.5
## 3 WESTSIDE  103.
```

---
# Plot it


```r
theme_set(theme_minimal(base_size = 18))

students_only %&gt;%
  group_by(test_site) %&gt;%
  summarize(mean = mean(post_test_score)) %&gt;%
  ggplot(aes(test_site, mean)) +
  geom_col(alpha = 0.8)
```

&lt;img src="w4_dplyr_files/figure-html/unnamed-chunk-70-1.png" width="100%" /&gt;

---
class: inverse, left, middle

# A couple more
## recode() and rename()

---
# Recode with `ifelse()`

Recoding into dichotomous variable with `ifelse()`

`ifelse(`test, yes, no`)`

*or*

`ifelse(`logical statement, Do this `if` TRUE, `else` do this`)`

---
# Recode with `ifelse()`

Recoding into dichotomous variable with `ifelse()`

**Remember to pair with `mutate()`**


```r
students_only %&gt;% 
  mutate(test_site = ifelse(test_site == "JONES", "district 1", "district 2"))
```

```
## # A tibble: 45 x 25
##    test_year test_~1 test_~2 stude~3 pre_t~4 pre_t~5 post_~6 post_~7 perce~8 unit_~9 unit_~* unit_~* unit_~* unit_~* unit_~* unit_~*
##    &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
##  1 06/01/20~ YEAR E~ distri~ Virden~      43 29%          92 61%     32%           3 12%           4 16%           6 24%           8
##  2 06/01/20~ YEAR E~ distri~ Virden~      46 31%         104 69%     38%           5 20%           5 20%           6 24%           8
##  3 06/01/20~ YEAR E~ distri~ Virden~      39 26%          75 50%     24%           4 16%           4 16%           6 24%           9
##  4 06/01/20~ YEAR E~ distri~ Virden~      35 23%         115 77%     54%           4 16%           4 16%           6 24%          10
##  5 06/01/20~ YEAR E~ distri~ Virden~      46 31%          85 57%     26%           2 8%            5 20%           6 24%           7
##  6 06/01/20~ YEAR E~ distri~ Virden~      35 23%          91 61%     38%           5 20%           5 20%           7 28%           7
##  7 06/01/20~ YEAR E~ distri~ Virden~      40 27%          96 64%     37%           5 20%           5 20%           6 24%           7
##  8 06/01/20~ YEAR E~ distri~ Virden~      39 26%          74 49%     23%           4 16%           5 20%           5 20%           8
##  9 06/01/20~ YEAR E~ distri~ Virden~      40 27%          90 60%     33%           6 24%           4 16%           5 20%           8
## 10 06/01/20~ YEAR E~ distri~ Virden~      45 30%          86 57%     27%           4 16%           5 20%           5 20%           7
## # ... with 35 more rows, 9 more variables: unit_4_percent &lt;chr&gt;, unit_5_6_score &lt;dbl&gt;, unit_5_6_percent &lt;chr&gt;, unit_7_score &lt;dbl&gt;,
## #   unit_7_percent &lt;chr&gt;, unit_8_score &lt;dbl&gt;, unit_8_percent &lt;chr&gt;, total_score &lt;dbl&gt;, total_percent_correct &lt;chr&gt;, and abbreviated
## #   variable names 1: test_type, 2: test_site, 3: student_id, 4: pre_test_score, 5: pre_test_percent, 6: post_test_score,
## #   7: post_test_percent, 8: percentage_change, 9: unit_1_score, *: unit_1_percent, *: unit_2_score, *: unit_2_percent,
## #   *: unit_3_score, *: unit_3_percent, *: unit_4_score
```

---
# Recode with `recode()`

Recoding into multinomial variable


```r
recode(variable,
       old_category_1 = "new_category_1",
	     old_category_2 = "new_category_2",
	     old_category_3 = "new_category_3",
       ...
)
```

---
# Recode with `recode()`

Recoding into multinomial variable

**Remember to pair with `mutate()`**


```r
students_only %&gt;% 
  mutate(test_site = recode(test_site,
                            JONES = "Jones Middle",
                            VIRDEN = "Virden Elementary",
                            WESTSIDE = "Westside High")
         )
```

```
## # A tibble: 45 x 25
##    test_year test_~1 test_~2 stude~3 pre_t~4 pre_t~5 post_~6 post_~7 perce~8 unit_~9 unit_~* unit_~* unit_~* unit_~* unit_~* unit_~*
##    &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
##  1 06/01/20~ YEAR E~ Virden~ Virden~      43 29%          92 61%     32%           3 12%           4 16%           6 24%           8
##  2 06/01/20~ YEAR E~ Virden~ Virden~      46 31%         104 69%     38%           5 20%           5 20%           6 24%           8
##  3 06/01/20~ YEAR E~ Virden~ Virden~      39 26%          75 50%     24%           4 16%           4 16%           6 24%           9
##  4 06/01/20~ YEAR E~ Virden~ Virden~      35 23%         115 77%     54%           4 16%           4 16%           6 24%          10
##  5 06/01/20~ YEAR E~ Virden~ Virden~      46 31%          85 57%     26%           2 8%            5 20%           6 24%           7
##  6 06/01/20~ YEAR E~ Virden~ Virden~      35 23%          91 61%     38%           5 20%           5 20%           7 28%           7
##  7 06/01/20~ YEAR E~ Virden~ Virden~      40 27%          96 64%     37%           5 20%           5 20%           6 24%           7
##  8 06/01/20~ YEAR E~ Virden~ Virden~      39 26%          74 49%     23%           4 16%           5 20%           5 20%           8
##  9 06/01/20~ YEAR E~ Virden~ Virden~      40 27%          90 60%     33%           6 24%           4 16%           5 20%           8
## 10 06/01/20~ YEAR E~ Virden~ Virden~      45 30%          86 57%     27%           4 16%           5 20%           5 20%           7
## # ... with 35 more rows, 9 more variables: unit_4_percent &lt;chr&gt;, unit_5_6_score &lt;dbl&gt;, unit_5_6_percent &lt;chr&gt;, unit_7_score &lt;dbl&gt;,
## #   unit_7_percent &lt;chr&gt;, unit_8_score &lt;dbl&gt;, unit_8_percent &lt;chr&gt;, total_score &lt;dbl&gt;, total_percent_correct &lt;chr&gt;, and abbreviated
## #   variable names 1: test_type, 2: test_site, 3: student_id, 4: pre_test_score, 5: pre_test_percent, 6: post_test_score,
## #   7: post_test_percent, 8: percentage_change, 9: unit_1_score, *: unit_1_percent, *: unit_2_score, *: unit_2_percent,
## #   *: unit_3_score, *: unit_3_percent, *: unit_4_score
```

---
# Recode with `recode()`

Remember to use backticks for special characters


```r
mtcars %&gt;% 
  mutate(cyl_str = recode(cyl,
                      `4` = "cylinders4",
                      `6` = "cylinders6",
                      `8` = "cylinders8"))
```

---
# Recode with `case_when()`

Recoding across several variables, or if you find yourself using nested `ifelse()` statements

**Remember to pair with `mutate()`**





```r
penguins %&gt;% 
  mutate(species_big = 
           case_when(
             body_mass_g &gt; 4500 &amp; species == "Adelie" ~ "adelie_big",
             body_mass_g &gt; 4600 &amp; species == "Chinstrap" ~ "chinstrap_big",
             body_mass_g &gt; 6000 &amp; species == "Gentoo" ~ "gentoo_big",
             TRUE ~ "other"
           ))
```

--

* `TRUE` equivalent to `else` statement 

---
# `rename()`

`rename(new_name = old_name)`


```r
penguins %&gt;%
  rename(
    home = island,
    bill_length = bill_length_mm
  )
```

```
## # A tibble: 344 x 8
##    species home      bill_length bill_depth_mm flipper_length_mm body_mass_g sex     year
##    &lt;fct&gt;   &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;fct&gt;  &lt;int&gt;
##  1 Adelie  Torgersen        39.1          18.7               181        3750 male    2007
##  2 Adelie  Torgersen        39.5          17.4               186        3800 female  2007
##  3 Adelie  Torgersen        40.3          18                 195        3250 female  2007
##  4 Adelie  Torgersen        NA            NA                  NA          NA &lt;NA&gt;    2007
##  5 Adelie  Torgersen        36.7          19.3               193        3450 female  2007
##  6 Adelie  Torgersen        39.3          20.6               190        3650 male    2007
##  7 Adelie  Torgersen        38.9          17.8               181        3625 female  2007
##  8 Adelie  Torgersen        39.2          19.6               195        4675 male    2007
##  9 Adelie  Torgersen        34.1          18.1               193        3475 &lt;NA&gt;    2007
## 10 Adelie  Torgersen        42            20.2               190        4250 &lt;NA&gt;    2007
## # ... with 334 more rows
```

--

**NOT paired with `mutate()`**

---
# rename with `select()`


```r
penguins %&gt;% 
* select(species, home = island, bill_length = bill_length_mm, year)
```

```
## # A tibble: 344 x 4
##    species home      bill_length  year
##    &lt;fct&gt;   &lt;fct&gt;           &lt;dbl&gt; &lt;int&gt;
##  1 Adelie  Torgersen        39.1  2007
##  2 Adelie  Torgersen        39.5  2007
##  3 Adelie  Torgersen        40.3  2007
##  4 Adelie  Torgersen        NA    2007
##  5 Adelie  Torgersen        36.7  2007
##  6 Adelie  Torgersen        39.3  2007
##  7 Adelie  Torgersen        38.9  2007
##  8 Adelie  Torgersen        39.2  2007
##  9 Adelie  Torgersen        34.1  2007
## 10 Adelie  Torgersen        42    2007
## # ... with 334 more rows
```

---
# Final notes on `{dplyr}`

* We could spend weeks on this


* We'll be using it all term long


* Verbs can help you gain fluency


* There are also conditional and all-inclusive versions of `mutate`, `select`, and `summarize`
  + [`across()`](https://dplyr.tidyverse.org/reference/across.html)

---
class: inverse, left, middle

# Next time

---
# Before next class

* Final Project
  + .red[Final Project: Outline]
* Reading
  + [R4DS 13](https://r4ds.had.co.nz/relational-data.html)
* Supplemental Learning
  + [RStudio Primer: Join Data Sets](https://rstudio.cloud/learn/primers/4.3)
  + [Codecademy: Joining Tables in R](https://www.codecademy.com/courses/learn-r/lessons/r-multiple-tables/exercises/introduction)
* Homework
  + **Homework 4**

---
class: inverse, left, middle

---



    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
